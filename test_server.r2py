def echo_server(sockobj):
  def _echo_helper():
    log("Inside Echo Server")
    while True:
      msg = sockobj.recv(1024)
      sockobj.send(msg)
  return _echo_helper


if callfunc == 'initialize':
  serverip = getmyip()
  serverport = 12345

  server_sock = listenforconnection(serverip, serverport)

  while True:
    try:
      (remoteip, remoteport, sockobj) = server_sock.getconnection()
    except SocketWouldBlockError:
      continue
    else:
      # Launch the echo server.
      log("above create thread")
      createthread(echo_server(sockobj))
